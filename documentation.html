<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hydrogen Simulation - Technical Documentation</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-yellow: #d29922;
            --accent-purple: #a371f7;
            --accent-red: #f85149;
            --accent-orange: #db6d28;
            --border: #30363d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            padding: 3rem 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 3rem;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        h2 {
            color: var(--accent-blue);
            font-size: 1.8rem;
            margin: 2.5rem 0 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
        }

        h3 {
            color: var(--accent-green);
            font-size: 1.3rem;
            margin: 1.5rem 0 1rem;
        }

        h4 {
            color: var(--accent-yellow);
            font-size: 1.1rem;
            margin: 1rem 0 0.5rem;
        }

        p {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .library-card {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .library-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .library-card h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .library-card .version {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: normal;
        }

        .library-card p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .library-card code {
            background: var(--bg-primary);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--accent-purple);
        }

        .code-block {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            overflow-x: auto;
            border: 1px solid var(--border);
        }

        .code-block pre {
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .code-block .comment {
            color: var(--text-secondary);
        }

        .code-block .keyword {
            color: var(--accent-purple);
        }

        .code-block .string {
            color: var(--accent-green);
        }

        .code-block .number {
            color: var(--accent-orange);
        }

        .code-block .function {
            color: var(--accent-blue);
        }

        .diagram {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 2rem;
            margin: 1.5rem 0;
            text-align: center;
            border: 1px solid var(--border);
        }

        .diagram pre {
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
            display: inline-block;
            text-align: left;
        }

        .flow-diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            padding: 2rem;
        }

        .flow-box {
            background: var(--bg-primary);
            border: 2px solid var(--accent-blue);
            border-radius: 8px;
            padding: 1rem 2rem;
            min-width: 200px;
            text-align: center;
        }

        .flow-box.producer {
            border-color: var(--accent-yellow);
        }

        .flow-box.converter {
            border-color: var(--accent-purple);
        }

        .flow-box.consumer {
            border-color: var(--accent-green);
        }

        .flow-arrow {
            color: var(--text-secondary);
            font-size: 1.5rem;
        }

        .equation {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
            font-family: 'Times New Roman', serif;
            font-size: 1.2rem;
            border-left: 4px solid var(--accent-purple);
        }

        .equation .label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg-tertiary);
            color: var(--accent-blue);
            font-weight: 600;
        }

        tr:hover {
            background: var(--bg-tertiary);
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-blue {
            background: rgba(88, 166, 255, 0.2);
            color: var(--accent-blue);
        }

        .badge-green {
            background: rgba(63, 185, 80, 0.2);
            color: var(--accent-green);
        }

        .badge-yellow {
            background: rgba(210, 153, 34, 0.2);
            color: var(--accent-yellow);
        }

        .badge-purple {
            background: rgba(163, 113, 247, 0.2);
            color: var(--accent-purple);
        }

        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        .highlight {
            background: rgba(88, 166, 255, 0.1);
            border-left: 3px solid var(--accent-blue);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .warning {
            background: rgba(210, 153, 34, 0.1);
            border-left: 3px solid var(--accent-yellow);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .toc {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .toc h3 {
            margin-top: 0;
        }

        .toc ul {
            list-style: none;
            padding-left: 0;
        }

        .toc li {
            margin-bottom: 0.3rem;
        }

        .toc a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .toc a:hover {
            color: var(--accent-blue);
        }

        footer {
            text-align: center;
            padding: 2rem;
            border-top: 1px solid var(--border);
            margin-top: 3rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            h1 {
                font-size: 1.8rem;
            }
            .library-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Hydrogen Simulation System</h1>
            <p class="subtitle">Technical Documentation - Under the Hood</p>
        </header>

        <nav class="toc">
            <h3>Table of Contents</h3>
            <ul>
                <li><a href="#motivation">1. Project Motivation</a></li>
                <li><a href="#architecture">2. System Architecture</a></li>
                <li><a href="#libraries">3. Libraries & Technologies</a></li>
                <li><a href="#dynamic-nodes">4. Dynamic Node Management</a></li>
                <li><a href="#economic-model">5. Economic Model</a></li>
                <li><a href="#optimization">6. Optimization Process</a></li>
                <li><a href="#data-flow">7. Data Flow</a></li>
                <li><a href="#api">8. API Reference</a></li>
                <li><a href="#blender">9. Blender Visualization</a></li>
                <li><a href="#future">10. Future Directions</a></li>
            </ul>
        </nav>

        <!-- Section 1: Project Motivation -->
        <section id="motivation" class="section">
            <h2>1. Project Motivation</h2>

            <h3>The Data Problem</h3>
            <p>Real-world hydrogen and electricity data is extremely difficult to obtain. These systems are classified as <strong>critical infrastructure</strong>, which means operational data, pricing structures, and flow patterns are often proprietary or restricted for security reasons.</p>

            <p>This creates a significant barrier for researchers, students, and developers who want to understand hydrogen economics, grid integration challenges, or energy system optimization.</p>

            <h3>The Solution: Simulate Your Own Data</h3>
            <p>Rather than waiting for access to restricted datasets, this project takes a different approach: <strong>build a configurable simulation that generates realistic data</strong> based on economic principles.</p>

            <div class="highlight">
                <strong>Core Philosophy:</strong> Create a small-scale, fully controllable energy system where every parameter is transparent and adjustable. Use welfare-maximizing optimization to generate economically rational flows that can be analyzed, visualized, and understood.
            </div>

            <h3>What This Enables</h3>
            <ul>
                <li><strong>Economic Analysis:</strong> Understand marginal costs, willingness-to-pay, and market equilibrium concepts</li>
                <li><strong>Sensitivity Studies:</strong> Change one parameter and see how the entire system responds</li>
                <li><strong>Visualization:</strong> See energy flows in real-time with the 3D Blender integration</li>
                <li><strong>Education:</strong> Learn about linear programming, energy system modeling, and hydrogen economics</li>
                <li><strong>Prototyping:</strong> Test business case assumptions before committing to real infrastructure investments</li>
            </ul>

            <h3>Design Principles</h3>
            <table>
                <tr>
                    <th>Principle</th>
                    <th>Implementation</th>
                </tr>
                <tr>
                    <td>Transparency</td>
                    <td>All costs, capacities, and utility functions are visible and adjustable via the UI</td>
                </tr>
                <tr>
                    <td>Economic Rigor</td>
                    <td>Welfare-maximizing LP ensures economically rational dispatch decisions</td>
                </tr>
                <tr>
                    <td>Flexibility</td>
                    <td>Dynamic node management allows testing any network topology</td>
                </tr>
                <tr>
                    <td>Extensibility</td>
                    <td>Modular architecture supports adding new node types, carriers, and constraints</td>
                </tr>
            </table>
        </section>

        <!-- Section 2: Architecture -->
        <section id="architecture" class="section">
            <h2>2. System Architecture</h2>
            <p>The hydrogen simulation system consists of three main components that work together to model, optimize, and visualize a hydrogen/electricity network.</p>

            <div class="diagram">
                <pre>
    +------------------+     +------------------+     +------------------+
    |   Web Browser    |     |  Flask Server    |     |    Blender       |
    |  (controller.html|<--->|  (controller.py) |<--->| (visualization)  |
    +------------------+     +------------------+     +------------------+
            |                        |                        |
            |    HTTP/JSON API       |     JSON Files         |
            |                        |                        |
            v                        v                        v
    +------------------+     +------------------+     +------------------+
    |   User Input     |     |  oemof.solph     |     |  3D Scene        |
    | - Costs          |     |  (optimization)  |     | - Nodes          |
    | - Capacities     |     |  + HiGHS solver  |     | - Pipes          |
    | - Tranches       |     +------------------+     | - Flow Animation |
    +------------------+              |               +------------------+
                                      |
                                      v
                              +------------------+
                              |   NetworkX       |
                              |  (topology)      |
                              +------------------+
                </pre>
            </div>

            <h3>Component Overview</h3>
            <table>
                <tr>
                    <th>Component</th>
                    <th>File</th>
                    <th>Purpose</th>
                </tr>
                <tr>
                    <td><span class="badge badge-blue">Controller</span></td>
                    <td><code>controller.py</code></td>
                    <td>Flask web server providing REST API</td>
                </tr>
                <tr>
                    <td><span class="badge badge-green">Simulation</span></td>
                    <td><code>simulation.py</code></td>
                    <td>Energy system optimization with oemof</td>
                </tr>
                <tr>
                    <td><span class="badge badge-yellow">Network</span></td>
                    <td><code>network.py</code></td>
                    <td>Graph topology with NetworkX</td>
                </tr>
                <tr>
                    <td><span class="badge badge-purple">Visualization</span></td>
                    <td><code>blender_visualize.py</code></td>
                    <td>3D rendering in Blender</td>
                </tr>
            </table>
        </section>

        <!-- Section 2: Libraries -->
        <section id="libraries" class="section">
            <h2>3. Libraries & Technologies</h2>
            <p>The simulation uses a carefully selected stack of Python libraries, each serving a specific purpose in the energy system modeling pipeline.</p>

            <div class="library-grid">
                <div class="library-card">
                    <h4>oemof.solph <span class="version">v0.5+</span></h4>
                    <p><strong>Role:</strong> Energy System Optimization</p>
                    <p>Open Energy Modelling Framework - creates mathematical models of energy systems. Builds a linear/mixed-integer program from components (sources, sinks, transformers, buses).</p>
                    <p><strong>Key classes used:</strong></p>
                    <ul>
                        <li><code>EnergySystem</code> - Container for all components</li>
                        <li><code>Bus</code> - Energy carriers (electricity, hydrogen)</li>
                        <li><code>Source</code> - Producers (Alpha, Grid)</li>
                        <li><code>Sink</code> - Consumers (Charlie, Delta)</li>
                        <li><code>Converter</code> - Transformers (Bravo electrolyzer)</li>
                        <li><code>Flow</code> - Connections with costs/capacities</li>
                    </ul>
                </div>

                <div class="library-card">
                    <h4>Pyomo <span class="version">v6.0+</span></h4>
                    <p><strong>Role:</strong> Algebraic Modeling Language</p>
                    <p>oemof uses Pyomo internally to formulate the optimization problem. Pyomo translates the energy system into mathematical constraints and objectives.</p>
                    <p><strong>What it does:</strong></p>
                    <ul>
                        <li>Creates decision variables (flow quantities)</li>
                        <li>Defines constraints (capacity limits, efficiency)</li>
                        <li>Formulates objective function (minimize cost)</li>
                        <li>Interfaces with solvers (HiGHS, CBC, GLPK)</li>
                    </ul>
                </div>

                <div class="library-card">
                    <h4>HiGHS Solver <span class="version">v1.5+</span></h4>
                    <p><strong>Role:</strong> Linear Programming Solver</p>
                    <p>High-performance open-source solver for linear programming (LP) and mixed-integer programming (MIP). Finds optimal flow values.</p>
                    <p><strong>Algorithm:</strong> Simplex method with presolve</p>
                    <p><strong>Installation:</strong> <code>pip install highspy</code></p>
                    <p><strong>Fallback:</strong> CBC solver via <code>conda install coincbc</code></p>
                </div>

                <div class="library-card">
                    <h4>NetworkX <span class="version">v3.0+</span></h4>
                    <p><strong>Role:</strong> Graph/Network Topology</p>
                    <p>Creates and manages the directed graph representing the physical network structure (nodes and edges/pipes).</p>
                    <p><strong>Graph type:</strong> <code>DiGraph</code> (directed)</p>
                    <p><strong>Node attributes:</strong> position, type, carrier</p>
                    <p><strong>Edge attributes:</strong> carrier (electricity/hydrogen)</p>
                </div>

                <div class="library-card">
                    <h4>Flask <span class="version">v3.0+</span></h4>
                    <p><strong>Role:</strong> Web Framework</p>
                    <p>Lightweight WSGI web application framework providing the REST API for the controller interface.</p>
                    <p><strong>Endpoints:</strong></p>
                    <ul>
                        <li><code>GET /api/config</code> - Get configuration</li>
                        <li><code>POST /api/simulate</code> - Run simulation</li>
                        <li><code>POST /api/blender/launch</code> - Launch Blender</li>
                    </ul>
                </div>

                <div class="library-card">
                    <h4>Pandas <span class="version">v2.0+</span></h4>
                    <p><strong>Role:</strong> Data Manipulation</p>
                    <p>Handles time series data for the simulation periods and processes optimization results into DataFrames.</p>
                    <p><strong>Used for:</strong></p>
                    <ul>
                        <li>Creating time index for simulation</li>
                        <li>Storing flow results per timestep</li>
                        <li>Aggregating statistics (totals, averages)</li>
                    </ul>
                </div>

                <div class="library-card">
                    <h4>bpy (Blender Python) <span class="version">v4.0+</span></h4>
                    <p><strong>Role:</strong> 3D Visualization</p>
                    <p>Blender's Python API for creating 3D scenes programmatically. Built into Blender, not installed via pip.</p>
                    <p><strong>Creates:</strong></p>
                    <ul>
                        <li>Node meshes (spheres, cones, cubes)</li>
                        <li>Pipe geometry (cylinders)</li>
                        <li>Animated particle flows</li>
                        <li>Materials with emission</li>
                    </ul>
                </div>

                <div class="library-card">
                    <h4>Flask-CORS <span class="version">v4.0+</span></h4>
                    <p><strong>Role:</strong> Cross-Origin Requests</p>
                    <p>Enables the web interface to make API calls to the Flask server from a browser (handles CORS headers).</p>
                    <p><strong>Configuration:</strong> All origins allowed for development</p>
                </div>
            </div>
        </section>

        <!-- Section 3: Dynamic Node Management -->
        <section id="dynamic-nodes" class="section">
            <h2>4. Dynamic Node Management</h2>
            <p>The simulation supports dynamic creation, modification, and deletion of network nodes through the web interface. Nodes are persisted to a JSON registry file and automatically synchronized with the network topology.</p>

            <h3>3.1 Node Types</h3>
            <p>Three types of nodes can be created dynamically:</p>

            <table>
                <tr>
                    <th>Node Type</th>
                    <th>Description</th>
                    <th>Parameters</th>
                </tr>
                <tr>
                    <td><span class="badge badge-yellow">Generator</span></td>
                    <td>Electricity producer (e.g., solar, wind, baseload)</td>
                    <td>capacity (kW), cost (ct/kWh), profile_type</td>
                </tr>
                <tr>
                    <td><span class="badge badge-purple">Transformer</span></td>
                    <td>Converts between carriers (e.g., electrolyzer)</td>
                    <td>capacity, efficiency, cost, input/output carriers</td>
                </tr>
                <tr>
                    <td><span class="badge badge-green">Consumer</span></td>
                    <td>Consumes electricity and/or hydrogen</td>
                    <td>consumer_type, utility parameters</td>
                </tr>
            </table>

            <h3>3.2 Generator Profiles</h3>
            <p>Generators can have different production profiles:</p>
            <ul>
                <li><strong>Solar:</strong> Sine wave peaking at midday, zero at night</li>
                <li><strong>Wind:</strong> Variable pattern with multiple harmonics</li>
                <li><strong>Flat:</strong> Constant availability (baseload)</li>
            </ul>

            <div class="code-block">
<pre><span class="keyword">@dataclass</span>
<span class="keyword">class</span> <span class="function">GeneratorConfig</span>:
    name: str
    capacity: float = <span class="number">100.0</span>       <span class="comment"># Max capacity (kW)</span>
    cost: float = <span class="number">8.0</span>             <span class="comment"># Production cost (ct/kWh)</span>
    profile_type: str = <span class="string">'solar'</span>   <span class="comment"># 'solar', 'flat', 'wind'</span></pre>
            </div>

            <h3>3.3 Consumer Types</h3>
            <p>Three consumer utility models are supported:</p>

            <h4>Logarithmic Utility (Single Carrier)</h4>
            <div class="equation">
                U(x) = scale &times; ln(1 + x / shape)
                <div class="label">Used for electricity-only or hydrogen-only consumers</div>
            </div>

            <h4>Cobb-Douglas Utility (Dual Carrier)</h4>
            <div class="equation">
                U(h, e) = A &times; h<sup>&alpha;</sup> &times; e<sup>&beta;</sup>
                <div class="label">Requires fixed bundles of hydrogen (h) and electricity (e)</div>
            </div>

            <div class="code-block">
<pre><span class="keyword">@dataclass</span>
<span class="keyword">class</span> <span class="function">ConsumerConfig</span>:
    name: str
    consumer_type: str    <span class="comment"># 'logarithmic_electricity', 'logarithmic_hydrogen', 'cobb_douglas'</span>
    carrier: str          <span class="comment"># 'electricity', 'hydrogen', 'both'</span>

    <span class="comment"># Logarithmic params</span>
    log_scale: float = <span class="number">30.0</span>
    log_shape: float = <span class="number">5.0</span>
    log_max_quantity: float = <span class="number">25.0</span>
    log_num_tranches: int = <span class="number">5</span>

    <span class="comment"># Cobb-Douglas params</span>
    cd_A: float = <span class="number">15.0</span>
    cd_alpha: float = <span class="number">0.4</span>
    cd_beta: float = <span class="number">0.6</span>
    cd_max_bundles: float = <span class="number">15.0</span>
    cd_h_per_bundle: float = <span class="number">1.0</span>
    cd_e_per_bundle: float = <span class="number">3.0</span></pre>
            </div>

            <h3>3.4 Node Registry</h3>
            <p>Nodes are persisted to <code>node_registry.json</code> and automatically loaded at server startup:</p>

            <div class="code-block">
<pre>{
  <span class="string">"generators"</span>: [
    {<span class="string">"name"</span>: <span class="string">"Alpha"</span>, <span class="string">"capacity"</span>: <span class="number">100.0</span>, <span class="string">"cost"</span>: <span class="number">8.0</span>, <span class="string">"profile_type"</span>: <span class="string">"solar"</span>}
  ],
  <span class="string">"transformers"</span>: [
    {<span class="string">"name"</span>: <span class="string">"Bravo"</span>, <span class="string">"capacity"</span>: <span class="number">50.0</span>, <span class="string">"efficiency"</span>: <span class="number">0.7</span>, <span class="string">"cost"</span>: <span class="number">1.5</span>}
  ],
  <span class="string">"consumers"</span>: [
    {<span class="string">"name"</span>: <span class="string">"Charlie"</span>, <span class="string">"consumer_type"</span>: <span class="string">"logarithmic_hydrogen"</span>, ...},
    {<span class="string">"name"</span>: <span class="string">"Delta"</span>, <span class="string">"consumer_type"</span>: <span class="string">"logarithmic_electricity"</span>, ...},
    {<span class="string">"name"</span>: <span class="string">"Echo"</span>, <span class="string">"consumer_type"</span>: <span class="string">"cobb_douglas"</span>, ...}
  ]
}</pre>
            </div>

            <div class="highlight">
                <strong>Automatic Sync:</strong> When nodes are added, modified, or deleted via the API, the network topology (<code>network_data.json</code>) is automatically regenerated to include proper edges between components.
            </div>
        </section>

        <!-- Section 4: Economic Model -->
        <section id="economic-model" class="section">
            <h2>5. Economic Model</h2>
            <p>The simulation uses a <strong>welfare-maximizing</strong> economic model where the objective is to maximize total surplus (consumer utility minus production costs).</p>

            <h3>4.1 The Network Structure</h3>
            <p>The default network includes the following nodes (all nodes can be added/removed dynamically via the UI):</p>
            <div class="diagram">
                <div class="flow-diagram">
                    <div class="flow-box producer">
                        <strong>Alpha</strong><br>
                        Electricity Producer (Solar)<br>
                        <small>100 kW, 8 ct/kWh</small>
                    </div>
                    <div class="flow-arrow">electricity</div>
                    <div style="display: flex; gap: 3rem;">
                        <div>
                            <div class="flow-box converter">
                                <strong>Bravo</strong><br>
                                Electrolyzer<br>
                                <small>50 kW, 70% eff, 1.5 ct/kWh</small>
                            </div>
                            <div class="flow-arrow">hydrogen</div>
                            <div style="display: flex; gap: 1rem;">
                                <div class="flow-box consumer">
                                    <strong>Charlie</strong><br>
                                    H2 (Logarithmic)<br>
                                    <small>scale=30, shape=5</small>
                                </div>
                                <div class="flow-box consumer">
                                    <strong>Echo</strong><br>
                                    Bundles (Cobb-Douglas)<br>
                                    <small>1 kg H2 + 3 kWh elec</small>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="flow-box consumer">
                                <strong>Delta</strong><br>
                                Electricity (Logarithmic)<br>
                                <small>scale=25, shape=10</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h3>4.2 Objective Function</h3>
            <p>The optimization minimizes total "cost" which includes negative utility (willingness to pay):</p>

            <div class="equation">
                minimize: &Sigma; (Production Costs) - &Sigma; (Consumer Utility)
                <div class="label">Equivalent to: maximize Net Welfare</div>
            </div>

            <div class="code-block">
<pre><span class="comment"># How costs are modeled in oemof:</span>

<span class="comment"># Producer (Alpha) - positive cost</span>
Flow(nominal_value=<span class="number">100</span>, variable_costs=<span class="number">8.0</span>)  <span class="comment"># 8 ct/kWh to produce</span>

<span class="comment"># Consumer (Charlie) - NEGATIVE cost = utility/benefit</span>
Flow(nominal_value=<span class="number">5</span>, variable_costs=<span class="number">-25.0</span>)  <span class="comment"># -25 ct = 25 ct utility</span>

<span class="comment"># Total Cost = 8*production - 25*consumption</span>
<span class="comment"># Minimizing this = Maximizing (utility - cost) = Welfare</span></pre>
            </div>

            <h3>4.3 Utility Functions & Tranches</h3>
            <p>Consumer utility is modeled using mathematical functions that exhibit diminishing marginal utility. These are discretized into <strong>tranches</strong> for linear programming.</p>

            <h4>Logarithmic Utility</h4>
            <div class="equation">
                U(x) = scale &times; ln(1 + x / shape)
                <div class="label">Marginal utility: MU(x) = scale / (shape + x)</div>
            </div>
            <p>The marginal utility decreases as consumption increases. Tranches are generated by evaluating marginal utility at midpoints:</p>
            <div class="code-block">
<pre><span class="keyword">def</span> <span class="function">generate_tranches</span>(self):
    tranche_size = self.max_quantity / self.num_tranches
    tranches = []
    <span class="keyword">for</span> i <span class="keyword">in</span> range(self.num_tranches):
        midpoint = (i + <span class="number">0.5</span>) * tranche_size
        wtp = self.scale / (self.shape + midpoint)  <span class="comment"># Marginal utility at midpoint</span>
        tranches.append((tranche_size, wtp))
    <span class="keyword">return</span> tranches</pre>
            </div>

            <h4>Cobb-Douglas Utility</h4>
            <div class="equation">
                U(h, e) = A &times; h<sup>&alpha;</sup> &times; e<sup>&beta;</sup>
                <div class="label">Requires fixed-proportion bundles of hydrogen and electricity</div>
            </div>
            <p>Each bundle contains a fixed ratio of hydrogen and electricity. Marginal bundle utility decreases with consumption:</p>
            <div class="code-block">
<pre><span class="comment"># Example: 1 kg H2 + 3 kWh electricity per bundle</span>
<span class="comment"># With A=15, alpha=0.4, beta=0.6</span>
<span class="comment"># MU at bundle b: A * alpha * (h_per_bundle)^alpha * (e_per_bundle)^beta * b^(alpha+beta-1)</span></pre>
            </div>

            <h4>Example Tranche Table</h4>
            <table>
                <tr>
                    <th>Tranche</th>
                    <th>Charlie (H2, Log)</th>
                    <th>Delta (Elec, Log)</th>
                    <th>Echo (Bundles, C-D)</th>
                </tr>
                <tr>
                    <td>1st</td>
                    <td>5 kg @ 25 ct/kg</td>
                    <td>10 kWh @ 20 ct/kWh</td>
                    <td>3 bundles @ 18 ct</td>
                </tr>
                <tr>
                    <td>2nd</td>
                    <td>5 kg @ 18 ct/kg</td>
                    <td>10 kWh @ 14 ct/kWh</td>
                    <td>3 bundles @ 12 ct</td>
                </tr>
                <tr>
                    <td>3rd</td>
                    <td>5 kg @ 12 ct/kg</td>
                    <td>10 kWh @ 10 ct/kWh</td>
                    <td>3 bundles @ 8 ct</td>
                </tr>
            </table>

            <div class="highlight">
                <strong>Key Insight:</strong> A tranche is only consumed if the consumer's willingness to pay exceeds the marginal cost of production. For hydrogen, marginal cost = (electricity_cost + transform_cost) / efficiency = (8 + 1.5) / 0.7 = <strong>13.57 ct/kg</strong>. Tranches with WTP below this threshold won't be consumed!
            </div>

            <h3>4.4 Mathematical Formulation</h3>
            <div class="code-block">
<pre><span class="comment"># Decision Variables (per timestep t):</span>
x_alpha[t]      <span class="comment"># Electricity produced by Alpha</span>
x_grid[t]       <span class="comment"># Electricity from grid backup</span>
x_bravo_in[t]   <span class="comment"># Electricity input to Bravo</span>
x_bravo_out[t]  <span class="comment"># Hydrogen output from Bravo</span>
x_charlie_i[t]  <span class="comment"># Hydrogen to Charlie tranche i</span>
x_delta_i[t]    <span class="comment"># Electricity to Delta tranche i</span>

<span class="comment"># Objective:</span>
minimize: <span class="number">8</span>*x_alpha + <span class="number">15</span>*x_grid + <span class="number">1.5</span>*x_bravo_in
        - <span class="number">25</span>*x_charlie_1 - <span class="number">18</span>*x_charlie_2 - ...
        - <span class="number">20</span>*x_delta_1 - <span class="number">14</span>*x_delta_2 - ...

<span class="comment"># Constraints:</span>
x_bravo_out = <span class="number">0.7</span> * x_bravo_in     <span class="comment"># Efficiency</span>
x_alpha <= <span class="number">100</span>                      <span class="comment"># Capacity limit</span>
x_bravo_out <= <span class="number">50</span>                   <span class="comment"># Capacity limit</span>
x_charlie_i <= qty_i                <span class="comment"># Tranche limits</span>

<span class="comment"># Bus balance (Kirchhoff's law):</span>
x_alpha + x_grid = x_bravo_in + &Sigma;x_delta_i</pre>
            </div>
        </section>

        <!-- Section 5: Optimization Process -->
        <section id="optimization" class="section">
            <h2>6. Optimization Process</h2>
            <p>Here's the step-by-step process when you click "Run Simulation":</p>

            <h3>Step 1: Build Energy System</h3>
            <div class="code-block">
<pre><span class="comment"># Create time index for 24 periods</span>
date_range = pd.date_range(<span class="string">'2024-01-01'</span>, periods=<span class="number">24</span>, freq=<span class="string">'h'</span>)
es = solph.EnergySystem(timeindex=date_range)

<span class="comment"># Create buses (energy carriers)</span>
bus_electricity = solph.Bus(label=<span class="string">'electricity'</span>)
bus_hydrogen = solph.Bus(label=<span class="string">'hydrogen'</span>)

<span class="comment"># Create components and add to system</span>
es.add(bus_electricity, bus_hydrogen, alpha, bravo, charlie, delta, grid)</pre>
            </div>

            <h3>Step 2: Create Pyomo Model</h3>
            <div class="code-block">
<pre><span class="comment"># oemof converts to Pyomo optimization model</span>
model = solph.Model(es)

<span class="comment"># This creates:</span>
<span class="comment"># - ConcreteModel with variables, constraints, objective</span>
<span class="comment"># - Flow variables for each connection</span>
<span class="comment"># - Balance constraints for each bus</span>
<span class="comment"># - Capacity constraints from nominal_value</span></pre>
            </div>

            <h3>Step 3: Solve with HiGHS</h3>
            <div class="code-block">
<pre><span class="comment"># Attempt solvers in order of preference</span>
solvers = [<span class="string">'appsi_highs'</span>, <span class="string">'highs'</span>, <span class="string">'cbc'</span>, <span class="string">'glpk'</span>]

<span class="keyword">for</span> solver_name <span class="keyword">in</span> solvers:
    <span class="keyword">try</span>:
        model.solve(solver=solver_name)
        <span class="keyword">break</span>
    <span class="keyword">except</span>:
        <span class="keyword">continue</span>

<span class="comment"># HiGHS uses Simplex algorithm:</span>
<span class="comment"># 1. Convert to standard form</span>
<span class="comment"># 2. Find initial basic feasible solution</span>
<span class="comment"># 3. Pivot to improve objective</span>
<span class="comment"># 4. Repeat until optimal</span></pre>
            </div>

            <h3>Step 4: Extract Results</h3>
            <div class="code-block">
<pre><span class="comment"># Get results from solved model</span>
results = solph.processing.results(model)

<span class="comment"># Extract flow sequences</span>
alpha_flow = solph.views.node(results, <span class="string">'Alpha'</span>)[<span class="string">'sequences'</span>]
bravo_flow = solph.views.node(results, <span class="string">'Bravo'</span>)[<span class="string">'sequences'</span>]

<span class="comment"># Calculate totals</span>
total_electricity = alpha_flow.sum()
total_hydrogen = bravo_flow[<span class="string">'output'</span>].sum()

<span class="comment"># Calculate welfare</span>
total_utility = sum(consumed * wtp for each tranche)
total_cost = sum(produced * cost for each source)
welfare = total_utility - total_cost</pre>
            </div>

            <h3>Solver Comparison</h3>
            <table>
                <tr>
                    <th>Solver</th>
                    <th>Type</th>
                    <th>Speed</th>
                    <th>Installation</th>
                </tr>
                <tr>
                    <td>HiGHS (appsi)</td>
                    <td>LP/MIP</td>
                    <td>Fast</td>
                    <td><code>pip install highspy</code></td>
                </tr>
                <tr>
                    <td>CBC</td>
                    <td>LP/MIP</td>
                    <td>Medium</td>
                    <td><code>conda install coincbc</code></td>
                </tr>
                <tr>
                    <td>GLPK</td>
                    <td>LP/MIP</td>
                    <td>Slow</td>
                    <td><code>conda install glpk</code></td>
                </tr>
            </table>
        </section>

        <!-- Section 6: Data Flow -->
        <section id="data-flow" class="section">
            <h2>7. Data Flow</h2>
            <p>Data flows between components through JSON files and HTTP API calls.</p>

            <h3>6.1 Configuration Flow</h3>
            <div class="diagram">
                <pre>
User Input (HTML Form)
        |
        | JavaScript fetch()
        v
POST /api/config  ───────────────>  Flask Controller
        |                                   |
        |                           Updates current_config dict
        |                                   |
POST /api/simulate  ──────────────>  Creates SimulationConfig
        |                                   |
        |                           Builds oemof EnergySystem
        |                                   |
        |                           Solves with HiGHS
        |                                   |
        v                                   v
JSON Response  <──────────────────  Results dictionary
        |
        | Parse & display
        v
UI Update (charts, tables)
                </pre>
            </div>

            <h3>6.2 Network Data Flow</h3>
            <div class="diagram">
                <pre>
network.py                    network_data.json                 blender_visualize.py
    |                               |                                   |
    | create_hydrogen_network()     |                                   |
    |------------------------------>|                                   |
    |                               |     load_network_from_json()      |
    |                               |<----------------------------------|
    |                               |                                   |
    |                               |     build_visualization()         |
    |                               |---------------------------------->|
    |                               |                                   |
    |                               |     sync_from_blender()           |
    |                               |<----------------------------------|
    |                               |                                   |
    | load_network_from_json()      |                                   |
    |<------------------------------|                                   |
                </pre>
            </div>

            <h3>6.3 JSON Files</h3>

            <h4>node_registry.json (Source of Truth)</h4>
            <p>Stores all node configurations with their parameters. Modified by the Node Management API.</p>
            <div class="code-block">
<pre>{
  <span class="string">"generators"</span>: [
    {<span class="string">"name"</span>: <span class="string">"Alpha"</span>, <span class="string">"capacity"</span>: <span class="number">100.0</span>, <span class="string">"cost"</span>: <span class="number">8.0</span>, <span class="string">"profile_type"</span>: <span class="string">"solar"</span>, <span class="string">"position"</span>: [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>]}
  ],
  <span class="string">"transformers"</span>: [
    {<span class="string">"name"</span>: <span class="string">"Bravo"</span>, <span class="string">"capacity"</span>: <span class="number">50.0</span>, <span class="string">"efficiency"</span>: <span class="number">0.7</span>, <span class="string">"cost"</span>: <span class="number">1.5</span>, ...}
  ],
  <span class="string">"consumers"</span>: [
    {<span class="string">"name"</span>: <span class="string">"Charlie"</span>, <span class="string">"consumer_type"</span>: <span class="string">"logarithmic_hydrogen"</span>, <span class="string">"log_scale"</span>: <span class="number">30.0</span>, ...}
  ]
}</pre>
            </div>

            <h4>network_data.json (Derived)</h4>
            <p>Auto-generated from node_registry. Contains topology for visualization.</p>
            <div class="code-block">
<pre>{
  <span class="string">"nodes"</span>: [
    {
      <span class="string">"name"</span>: <span class="string">"Alpha"</span>,
      <span class="string">"node_type"</span>: <span class="string">"producer"</span>,
      <span class="string">"carrier"</span>: <span class="string">"electricity"</span>,
      <span class="string">"position"</span>: [<span class="number">0.0</span>, <span class="number">2.0</span>, <span class="number">0.0</span>]
    }
    <span class="comment">// ... derived from node_registry.generators/transformers/consumers</span>
  ],
  <span class="string">"edges"</span>: [
    {
      <span class="string">"source"</span>: <span class="string">"Alpha"</span>,
      <span class="string">"target"</span>: <span class="string">"Bravo"</span>,
      <span class="string">"carrier"</span>: <span class="string">"electricity"</span>
    }
    <span class="comment">// ... auto-generated based on carrier types</span>
  ]
}</pre>
            </div>
        </section>

        <!-- Section 7: API Reference -->
        <section id="api" class="section">
            <h2>8. API Reference</h2>

            <h3>GET /api/config</h3>
            <p>Returns current simulation configuration.</p>
            <div class="code-block">
<pre><span class="comment">// Response</span>
{
  <span class="string">"periods"</span>: <span class="number">24</span>,
  <span class="string">"alpha_capacity"</span>: <span class="number">100.0</span>,
  <span class="string">"alpha_cost"</span>: <span class="number">8.0</span>,
  <span class="string">"bravo_capacity"</span>: <span class="number">50.0</span>,
  <span class="string">"bravo_efficiency"</span>: <span class="number">0.7</span>,
  <span class="string">"bravo_cost"</span>: <span class="number">1.5</span>,
  <span class="string">"grid_cost"</span>: <span class="number">15.0</span>,
  <span class="string">"charlie_tranches"</span>: [[<span class="number">5.0</span>, <span class="number">25.0</span>], [<span class="number">5.0</span>, <span class="number">18.0</span>], ...],
  <span class="string">"delta_tranches"</span>: [[<span class="number">10.0</span>, <span class="number">20.0</span>], [<span class="number">10.0</span>, <span class="number">14.0</span>], ...]
}</pre>
            </div>

            <h3>POST /api/simulate</h3>
            <p>Runs the optimization and returns results.</p>
            <div class="code-block">
<pre><span class="comment">// Response</span>
{
  <span class="string">"status"</span>: <span class="string">"ok"</span>,
  <span class="string">"summary"</span>: {
    <span class="string">"total_alpha_production"</span>: <span class="number">720.0</span>,
    <span class="string">"total_grid_usage"</span>: <span class="number">0.0</span>,
    <span class="string">"total_hydrogen_produced"</span>: <span class="number">240.0</span>,
    <span class="string">"total_welfare"</span>: <span class="number">6184.67</span>
  },
  <span class="string">"flows"</span>: {
    <span class="string">"Alpha"</span>: [[<span class="number">30.0</span>], [<span class="number">30.0</span>], ...],
    <span class="string">"Bravo"</span>: [[<span class="number">14.29</span>, <span class="number">10.0</span>], ...]
  },
  <span class="string">"price_analysis"</span>: {
    <span class="string">"electricity_marginal_cost"</span>: <span class="number">8.0</span>,
    <span class="string">"hydrogen_marginal_cost"</span>: <span class="number">13.57</span>,
    <span class="string">"charlie_tranches_utilized"</span>: [<span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>]
  }
}</pre>
            </div>

            <h3>POST /api/blender/launch</h3>
            <p>Launches Blender with the visualization script.</p>
            <div class="code-block">
<pre><span class="comment">// Response</span>
{
  <span class="string">"status"</span>: <span class="string">"ok"</span>,
  <span class="string">"message"</span>: <span class="string">"Blender launched"</span>,
  <span class="string">"script"</span>: <span class="string">"C:\\...\\blender_visualize.py"</span>
}</pre>
            </div>

            <h3>Node Management API</h3>
            <p>CRUD endpoints for dynamic node management:</p>

            <h4>GET /api/nodes</h4>
            <p>Returns all configured nodes (generators, transformers, consumers).</p>
            <div class="code-block">
<pre><span class="comment">// Response</span>
{
  <span class="string">"generators"</span>: [{<span class="string">"name"</span>: <span class="string">"Alpha"</span>, <span class="string">"capacity"</span>: <span class="number">100.0</span>, ...}],
  <span class="string">"transformers"</span>: [{<span class="string">"name"</span>: <span class="string">"Bravo"</span>, <span class="string">"capacity"</span>: <span class="number">50.0</span>, ...}],
  <span class="string">"consumers"</span>: [{<span class="string">"name"</span>: <span class="string">"Charlie"</span>, <span class="string">"consumer_type"</span>: <span class="string">"logarithmic_hydrogen"</span>, ...}]
}</pre>
            </div>

            <h4>POST /api/nodes/generators</h4>
            <p>Add a new generator.</p>
            <div class="code-block">
<pre><span class="comment">// Request</span>
{
  <span class="string">"name"</span>: <span class="string">"Solar2"</span>,
  <span class="string">"capacity"</span>: <span class="number">50.0</span>,
  <span class="string">"cost"</span>: <span class="number">6.0</span>,
  <span class="string">"profile_type"</span>: <span class="string">"solar"</span>
}

<span class="comment">// Response</span>
{<span class="string">"status"</span>: <span class="string">"ok"</span>, <span class="string">"generator"</span>: {...}}</pre>
            </div>

            <h4>PUT /api/nodes/generators/&lt;name&gt;</h4>
            <p>Update an existing generator.</p>

            <h4>DELETE /api/nodes/generators/&lt;name&gt;</h4>
            <p>Delete a generator.</p>
            <div class="code-block">
<pre><span class="comment">// Response</span>
{<span class="string">"status"</span>: <span class="string">"ok"</span>, <span class="string">"message"</span>: <span class="string">"Generator Solar2 deleted"</span>}</pre>
            </div>

            <h4>POST /api/nodes/transformers</h4>
            <p>Add a new transformer (electrolyzer).</p>
            <div class="code-block">
<pre><span class="comment">// Request</span>
{
  <span class="string">"name"</span>: <span class="string">"Electrolyzer2"</span>,
  <span class="string">"capacity"</span>: <span class="number">30.0</span>,
  <span class="string">"efficiency"</span>: <span class="number">0.75</span>,
  <span class="string">"cost"</span>: <span class="number">1.2</span>
}</pre>
            </div>

            <h4>POST /api/nodes/consumers</h4>
            <p>Add a new consumer.</p>
            <div class="code-block">
<pre><span class="comment">// Request - Logarithmic consumer</span>
{
  <span class="string">"name"</span>: <span class="string">"Factory"</span>,
  <span class="string">"consumer_type"</span>: <span class="string">"logarithmic_electricity"</span>,
  <span class="string">"log_scale"</span>: <span class="number">25.0</span>,
  <span class="string">"log_shape"</span>: <span class="number">8.0</span>,
  <span class="string">"log_max_quantity"</span>: <span class="number">40.0</span>
}

<span class="comment">// Request - Cobb-Douglas consumer</span>
{
  <span class="string">"name"</span>: <span class="string">"Plant"</span>,
  <span class="string">"consumer_type"</span>: <span class="string">"cobb_douglas"</span>,
  <span class="string">"cd_A"</span>: <span class="number">20.0</span>,
  <span class="string">"cd_alpha"</span>: <span class="number">0.5</span>,
  <span class="string">"cd_beta"</span>: <span class="number">0.5</span>,
  <span class="string">"cd_h_per_bundle"</span>: <span class="number">2.0</span>,
  <span class="string">"cd_e_per_bundle"</span>: <span class="number">5.0</span>,
  <span class="string">"cd_max_bundles"</span>: <span class="number">10.0</span>
}</pre>
            </div>

            <div class="highlight">
                <strong>Note:</strong> All node modification endpoints automatically update <code>node_registry.json</code> and regenerate <code>network_data.json</code> with proper edge connections.
            </div>
        </section>

        <!-- Section 8: Blender Visualization -->
        <section id="blender" class="section">
            <h2>9. Blender Visualization</h2>
            <p>The Blender visualization creates a 3D representation of the network with animated flow particles.</p>

            <h3>9.1 Node Representations</h3>
            <table>
                <tr>
                    <th>Node Type</th>
                    <th>Shape</th>
                    <th>Color</th>
                </tr>
                <tr>
                    <td>Producer (Alpha)</td>
                    <td>Sphere</td>
                    <td>Yellow (#FFD700)</td>
                </tr>
                <tr>
                    <td>Converter (Bravo)</td>
                    <td>Cylinder</td>
                    <td>Purple (#9370DB)</td>
                </tr>
                <tr>
                    <td>Consumer (Charlie, Delta)</td>
                    <td>Cone</td>
                    <td>Green/Blue</td>
                </tr>
            </table>

            <h3>9.2 Pipe Colors by Carrier</h3>
            <ul>
                <li><strong>Electricity:</strong> Blue pipes with blue particle flow</li>
                <li><strong>Hydrogen:</strong> Orange pipes with orange particle flow</li>
            </ul>

            <h3>9.3 Animation System</h3>
            <div class="code-block">
<pre><span class="comment"># Flow particles are animated along pipe paths</span>
<span class="keyword">def</span> <span class="function">animate_particles</span>(pipe, num_particles=<span class="number">5</span>):
    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_particles):
        <span class="comment"># Create small sphere</span>
        particle = create_sphere(radius=<span class="number">0.1</span>)

        <span class="comment"># Keyframe positions along pipe</span>
        <span class="keyword">for</span> frame <span class="keyword">in</span> range(<span class="number">120</span>):
            t = (frame + i * <span class="number">24</span>) / <span class="number">120</span>  <span class="comment"># Offset each particle</span>
            pos = lerp(pipe.start, pipe.end, t % <span class="number">1.0</span>)
            particle.location = pos
            particle.keyframe_insert(data_path=<span class="string">"location"</span>)</pre>
            </div>

            <h3>9.4 Sync Workflow</h3>
            <ol>
                <li>Run simulation from web controller</li>
                <li>Click "Launch Blender" to open visualization</li>
                <li>Move nodes in Blender as desired</li>
                <li>Run <code>sync_from_blender()</code> in Blender console</li>
                <li>New positions saved to <code>network_data.json</code></li>
                <li>Click "Sync from Blender" in web controller</li>
            </ol>
        </section>

        <!-- Section 10: Future Directions -->
        <section id="future" class="section">
            <h2>10. Future Directions</h2>
            <p>This simulation provides a foundation for exploring hydrogen economics. Here are potential directions for extending the model:</p>

            <h3>10.1 Adding Realism</h3>

            <h4>Noise and Uncertainty</h4>
            <p>Real energy systems don't operate with perfect information. Future enhancements could include:</p>
            <ul>
                <li><strong>Stochastic production profiles:</strong> Add random variation to solar/wind output</li>
                <li><strong>Demand uncertainty:</strong> Consumer willingness-to-pay that varies over time</li>
                <li><strong>Equipment failures:</strong> Random outages for generators and electrolyzers</li>
                <li><strong>Price volatility:</strong> Grid electricity prices that fluctuate hourly</li>
            </ul>

            <h4>Geographic Factors</h4>
            <p>Distance matters in real energy systems:</p>
            <ul>
                <li><strong>Cable/pipeline lengths:</strong> Add distance-based costs for electricity transmission and hydrogen transport</li>
                <li><strong>Map integration:</strong> Place nodes on a real map to calculate actual distances</li>
                <li><strong>Regional pricing:</strong> Different electricity costs in different locations</li>
                <li><strong>Transport losses:</strong> Energy losses proportional to distance</li>
            </ul>

            <h3>10.2 Economic Analysis Questions</h3>
            <p>The simulation can help answer practical business questions:</p>

            <div class="highlight">
                <strong>Break-even Analysis:</strong> At what hydrogen price does electrolysis become economically viable? With current electricity at 8 ct/kWh and 70% efficiency, the marginal cost is ~13.57 ct/kg. How does this change with cheaper renewable electricity?
            </div>

            <table>
                <tr>
                    <th>Question</th>
                    <th>Approach</th>
                </tr>
                <tr>
                    <td>What electricity price makes H2 production viable?</td>
                    <td>Vary generator cost, observe when Bravo starts producing</td>
                </tr>
                <tr>
                    <td>What WTP justifies 500 kg/day hydrogen consumption?</td>
                    <td>Adjust consumer scale parameters until consumption reaches target</td>
                </tr>
                <tr>
                    <td>When is hydrogen storage more valuable than batteries?</td>
                    <td>Compare welfare with H2 storage vs battery under variable solar</td>
                </tr>
                <tr>
                    <td>What's the optimal electrolyzer size?</td>
                    <td>Sweep Bravo capacity, find welfare-maximizing configuration</td>
                </tr>
            </table>

            <h3>10.3 Storage and Temporal Displacement</h3>
            <p>One of hydrogen's key advantages is long-duration storage. The simulation already supports both battery and hydrogen storage, enabling comparison studies:</p>

            <ul>
                <li><strong>Diurnal arbitrage:</strong> Store excess solar midday, release in evening peak</li>
                <li><strong>Seasonal storage:</strong> Extend to multi-day periods to model weekly/seasonal patterns</li>
                <li><strong>Hybrid strategies:</strong> When to use batteries (fast response, high efficiency) vs H2 storage (large capacity, lower efficiency)</li>
                <li><strong>Value of flexibility:</strong> Quantify the welfare gain from adding storage to a system</li>
            </ul>

            <div class="code-block">
<pre><span class="comment"># Research question: Benefits of hybrid storage</span>
<span class="comment"># Compare three scenarios:</span>
Scenario A: Solar + Electrolyzer only
Scenario B: Solar + Electrolyzer + Battery
Scenario C: Solar + Electrolyzer + Battery + H2 Storage

<span class="comment"># Measure: Total welfare, curtailment, consumer satisfaction</span></pre>
            </div>

            <h3>10.4 Real-World Integration</h3>
            <p>Moving beyond abstract models toward real project planning:</p>

            <h4>Adding Real Projects</h4>
            <ul>
                <li><strong>Power plants:</strong> Model actual solar/wind farms with their specific capacities and cost structures</li>
                <li><strong>Industrial consumers:</strong> Steel plants, refineries, ammonia production with realistic H2 demand profiles</li>
                <li><strong>Existing infrastructure:</strong> Model connections to real grid nodes and industrial sites</li>
            </ul>

            <h4>Business Case Development</h4>
            <p>Use the simulation to build investment cases:</p>
            <ul>
                <li><strong>Sensitivity analysis:</strong> How does project NPV change with electricity price, H2 demand, or equipment costs?</li>
                <li><strong>Risk assessment:</strong> Monte Carlo simulations with parameter uncertainty</li>
                <li><strong>Hybrid systems:</strong> Often the optimal solution combines multiple technologies - demonstrate why pure H2 or pure battery rarely wins</li>
            </ul>

            <h3>10.5 Validating General Findings</h3>
            <p>Use the model to reproduce and understand findings from energy research:</p>

            <ul>
                <li><strong>Electrolysis efficiency thresholds:</strong> At what efficiency does electrolysis become competitive with SMR (steam methane reforming)?</li>
                <li><strong>Grid integration limits:</strong> How much variable renewable generation can a system absorb before curtailment becomes excessive?</li>
                <li><strong>Sector coupling benefits:</strong> Quantify the welfare gain from allowing electricity-hydrogen conversion vs separate systems</li>
                <li><strong>Price formation:</strong> Observe how marginal costs determine market-clearing prices in the simulation</li>
            </ul>

            <div class="highlight">
                <strong>Validation Approach:</strong> Take a known result from energy economics literature (e.g., "electrolysis needs electricity below X ct/kWh to compete"), configure the simulation with those parameters, and verify the model reproduces the finding. This builds confidence in the model's economic logic.
            </div>

            <h3>10.6 Technical Enhancements</h3>
            <table>
                <tr>
                    <th>Enhancement</th>
                    <th>Description</th>
                    <th>Complexity</th>
                </tr>
                <tr>
                    <td>Multi-period investment</td>
                    <td>Optimize capacity additions over time, not just dispatch</td>
                    <td>High</td>
                </tr>
                <tr>
                    <td>Fuel cells</td>
                    <td>Add H2-to-electricity conversion for grid services</td>
                    <td>Medium</td>
                </tr>
                <tr>
                    <td>Network constraints</td>
                    <td>Model transmission capacity limits between nodes</td>
                    <td>Medium</td>
                </tr>
                <tr>
                    <td>Multiple carriers</td>
                    <td>Add heat, natural gas, or synthetic fuels</td>
                    <td>High</td>
                </tr>
                <tr>
                    <td>Real-time data feeds</td>
                    <td>Connect to APIs for live electricity prices</td>
                    <td>Medium</td>
                </tr>
            </table>
        </section>

        <footer>
            <p>Hydrogen Simulation System - Technical Documentation</p>
            <p>Built with oemof.solph, NetworkX, Flask, and Blender</p>
        </footer>
    </div>
</body>
</html>
